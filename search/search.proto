syntax = "proto3";

package search;
option go_package = "search";
// option go_package = "github.com/unliar/happysooner-proto/v2/search";

// æ•°æ®æ¡¶ç±»å‹
enum BucketTypes {
  NoneType = 0;
  Article = 1; // æ–‡ç« ç±»å‹
  Author = 2;  // ä½œè€…
}
// æ•°æ®ä»“åº“ç±»å‹
enum CollectionTypes {
  Test = 0;
  Happy = 1;
}

// æœç´¢ç»“æœ
message SearchResult { repeated string Results = 1; }

// åˆ é™¤æœç´¢
message FlushSearchRequest {
  CollectionTypes Collection = 1; // ç±»ä¼¼äºdatabaseçš„æ¦‚å¿µ
  BucketTypes Bucket = 2;         // ç±»ä¼¼äºè¡¨çš„æ¦‚å¿µ
  string Object = 3; // è¿™ä¸ªç±»ä¼¼äºkeyçš„æ¦‚å¿µ æœç´¢ä¼šæ ¹æ®valueæœç´¢keyğŸ”
}
// é”™è¯¯ç±»å‹
enum SearchErrors {
  NoneError = 0;               // é»˜è®¤å€¼
  SearchCommonError = 4000001; // é€šç”¨error
}

message ErrorResponse { SearchErrors ErrorInfo = 1; }
// æ’å…¥æœç´¢æ•°æ®è¯·æ±‚
message PostSearchSourceRequest {
  CollectionTypes Collection = 1; // ç±»ä¼¼äºdatabaseçš„æ¦‚å¿µ
  BucketTypes Bucket = 2;         // ç±»ä¼¼äºè¡¨çš„æ¦‚å¿µ
  string Object = 3; // è¿™ä¸ªç±»ä¼¼äºkeyçš„æ¦‚å¿µ æœç´¢ä¼šæ ¹æ®valueæœç´¢keyğŸ”
  string Text = 4; // æ•°æ®åˆ†è¯å†…å®¹
}

// è·å–æœç´¢ç»“æœ
message GetSearchRequest {
  CollectionTypes Collection = 1; // ç±»ä¼¼äºdatabaseçš„æ¦‚å¿µ
  BucketTypes Bucket = 2;         // ç±»ä¼¼äºè¡¨çš„æ¦‚å¿µ
  string Text = 3;                // æœç´¢æ•°æ®
}
service searchSV {
  // è·å–æœç´¢ç»“æœ
  rpc GetSearchByType(GetSearchRequest) returns (SearchResult);

  // FlushæŸä¸ªæœç´¢Object
  rpc FlushSearchByObject(FlushSearchRequest) returns (ErrorResponse);

  // FlushæŸä¸ªæœç´¢Bucket
  rpc FlushSearchByBucket(FlushSearchRequest) returns (ErrorResponse);

  // FlushæŸä¸ªæœç´¢Collection
  rpc FlushSearchByCollection(FlushSearchRequest) returns (ErrorResponse);

  // æ’å…¥æœç´¢èµ„æºæ•°æ®
  rpc PostSearchSource(PostSearchSourceRequest) returns (ErrorResponse);
}